<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>customer locator</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<style>
	.jumbotron {
    background-color: rgba(0, 0, 0, 0.5);
	}
	</style>
  <style>
    /* Always set the map height explicitly to define the size of the div
     * element that contains the map. */
    #map {
      height: 100%;
    }
    /* Optional: Makes the sample page fill the window. */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
  </head>

  <body background="google_maps.jpeg">
    <div class="container" style ="padding-top:35px;" id="jumbo">
      <div class="header clearfix">
        <nav class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Customer Locator</a>
    </div>
          <!--<ul class="nav nav-pills pull-right">
            <li role="presentation" class="active"><a href="#">Home</a></li>
            <li role="presentation"><a href="#">About</a></li>
            <li role="presentation"><a href="#">Contact</a></li>
          </ul>-->
		  <ul class="nav nav-pills pull-right">
            <li role="presentation" class="active" style="padding-top:5px;"><a href="#"><b>Welcome xyz</b></a></li>
          </ul>
        </nav>
        <h4 class="text-muted">Customer Locator</h4>
      </div>

      <div class="jumbotron" style ="color:white;font-family:Quattrocento Sans,sans-serif;">
        <h1>Hi, I am Alan !!!</h1>
        <p class="lead">Have you ever thought finding your next job would get so easier??</p>
        <p><center><a class="btn btn-lg btn-primary" href="#" role="button" onclick = "PlotMap();">Find Jobs</a></center></p>
      </div>
      </div>
    </div>
    <div style="height:100%; width:100%;">
	<div id="map"></div>
</div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script type="text/javascript">
	var map;
	//var jsonString = " 'data' : [{lat: '33.34',long: '-112.02',name: 'kkk'}, {lat: '32.12',long: '-110.93',name:'lll'},{lat: '31.80',long: '-106.40',name:'dsds'},{lat: '33.93',long: '-118.40',name:'sdd'},{lat: '32.73',long: '-117.17',name:'asda'},{lat: '28.55',long: '-81.33',name: 'sdd'},{lat: '41.90',long: '-87.65',name: 'asdas'}]";
	var jsonstring = '[{"lat": "33.34","long": "-112.02","name": "kkk"}, {"lat": "32.12","long": "-110.93","name":"lll"}]';
	function initMap() {
    alert('init called');
	var myLatLng = {lat: -34.397, lng: 150.644};
	  map = new google.maps.Map(document.getElementById('map'), {
		center: {lat: -34.397, lng: 150.644},
		zoom: 8
	  });

	  /*var marker = new google.maps.Marker({
		position: myLatLng,
		map: map,
		title: 'Hello World!'
  });*/

	}

	function googleMaps()
	{
		//alert('google maps called');
    //alert(PlotMap());
    $( "#jumbo" ).hide();
		$.ajax({
					type: 'GET',
          dataType: 'jsonp',
					url: 'https://authenticjobs.com/api/?api_key=8196bf75da67e8644ad9fecd1412ba73&method=aj.jobs.search&keyword=java&format=json',
					success: function(jsonstring)
					{
              console.log(jsonstring);
							var jsonobj = eval(jsonstring);
              //alert(jsonobj.listings.listing[0].id);
							var googlemapdata = new Array();
							var mapOptions = {
								  center: {lat: 38.83, lng: -77.01},
								  zoom: 4
								};
							var map = new google.maps.Map(document.getElementById('map'), mapOptions);
							var infowindow = new google.maps.InfoWindow();
							var marker, i;
							for (i = 0; i < jsonobj.listings.listing.length; i++)
							{
                if(jsonobj.listings.listing[i].hasOwnProperty('company') && jsonobj.listings.listing[i].company.hasOwnProperty('location'))
                {
                  //alert(jsonobj.listings.listing[i].company.location.lat);
  							  marker = new google.maps.Marker({
                  position: new google.maps.LatLng(jsonobj.listings.listing[i].company.location.lat, jsonobj.listings.listing[i].company.location.lng),
    							map: map
							  });

								google.maps.event.addListener(marker, 'click', (function(marker, i) {
								return function() {
								var setcontentlong = "<p><b>Company</b>: " + jsonobj.listings.listing[i].company.name+"</p>" ;
                setcontentlong += "<p><b>Position</b>: "+"<a href='"+jsonobj.listings.listing[i].url+"'>"+jsonobj.listings.listing[i].title+"</a></p>";
                console.log(setcontentlong);
								  infowindow.setContent(setcontentlong);
								  infowindow.open(map, marker);
								}
							  })(marker, i));
              }
							 }
					}
				});
}


function PlotMap() {
  console.log("plot called");
  var result;
    $.ajax({
        url: 'https://api.wit.ai/message',
        async: false,
        data: {
            'q': 'Java in New York?',
            'access_token': 'ILFXAC47HW5DWDN4GJB5CIMTG4PUMVMC'
        },
        method: "GET",
        dataType: 'jsonp',
        success: function(response) {
        console.log("ajax returned");
        result = handleData(response);
        console.log(result);
        return googleMaps();
          //  console.log(result);
        }
    });
    console.log("gonna return");
    //return result;
}




function handleData(response) {
    var skillList = new Array();
    $.each(response["entities"]["skill"], function(i, obj) {
        skillList.push(obj.value)
    });

    var locationList = new Array();
    $.each(response["entities"]["location"], function(i, obj) {
        locationList.push(obj.value)
    });

    var fields = {
        skill: skillList,
        location: locationList
    }
    return fields;
}



    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDnRMUTTnPIsbv48o5Ljg2USpUKMJfLqK8">
    </script>
  </body>
</html>
